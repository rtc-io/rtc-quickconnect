!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.quickconnect=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){(function(c){"use strict";var d=a("rtc-tools"),e=a("mbus"),f=a("rtc-tools/cleanup"),g=a("rtc-core/plugin"),h=d.logger("rtc-quickconnect"),i=(a("cog/defaults"),a("cog/extend")),j=a("cog/getable"),k=a("./messenger");b.exports=function(b,l){function m(a,b){S.set(a,{active:!1,pc:b,channels:j({}),streams:[],lastping:Date.now()})}function n(a){var b=S.get(a);b&&(h("ending call to: "+a),b.channels.keys().forEach(function(c){var d=b.channels.get(c),e=[a,d,c];J.apply(J,["channel:closed"].concat(e)),J.apply(J,["channel:closed:"+c].concat(e)),d.onopen=null}),b.streams.forEach(function(b){J("stream:removed",a,b)}),S["delete"](a),0===S.keys().length&&y(),J("call:ended",a,b.pc),f(b.pc))}function o(a,b,d){var e=S.get(a),f=[].concat(b.getRemoteStreams());e.active=!0,e.streams=[].concat(b.getRemoteStreams()),b.onaddstream=r(a),b.onremovestream=s(a),h(J.id+" - "+a+" call start: "+f.length+" streams"),J("call:started",a,b,d),w(),c.nextTick(function(){f.forEach(E(a))})}function p(){clearTimeout(W),Q||N&&(!U||H)&&G&&(V&&R.length<V||(W=setTimeout(function(){var a=i({room:L},P);J.announce(a),Q=!0},0)))}function q(a){var b,c,f=u(a);f.room===L&&(n(a),b=d.createConnection(i({},l,{iceServers:G}),(l||{}).constraints),J("peer:connect",f.id,b,f),m(f.id,b),R.forEach(function(a){b.addStream(a)}),J.isMaster(f.id)?(h("is master, creating data channels: ",Object.keys(T)),Object.keys(T).forEach(function(a){v(b.createDataChannel(a,T[a]),b,f)})):b.ondatachannel=function(c){var d=c&&c.channel;d&&void 0!==T[d.label]&&v(d,b,u(a))},h("coupling "+J.id+" to "+f.id),c=d.couple(b,a,J,i({},l,{logger:e("pc."+a,J)})),J("peer:couple",a,b,f,c),c.once("connected",o.bind(null,a,b,f)),c.once("closed",n.bind(null,a)),J.isMaster(a)&&c.createOffer())}function r(a){return function(b){h("peer "+a+" added stream"),F(a),E(a)(b.stream)}}function s(a){return function(b){h("peer "+a+" removed stream"),F(a),J("stream:removed",a,b.stream)}}function t(a){var b=S.get(a);if(!b)throw new Error("No active call for peer: "+a);return b}function u(a){var b=J.peers.get(a);return b&&b.data}function v(a,b,c){function d(){var d=S.get(c.id),f=[c.id,a,c,b];h('reporting channel "'+a.label+'" ready, have call: '+!!d),clearInterval(e),a.onopen=null,d&&d.channels.set(a.label,a),h("triggering channel:opened events for channel: "+a.label),J.apply(J,["channel:opened"].concat(f)),J.apply(J,["channel:opened:"+a.label].concat(f))}var e;return h("channel "+a.label+" discovered for peer: "+c.id),"open"===a.readyState?d():(h("channel not ready, current state = "+a.readyState),a.onopen=d,void(e=setInterval(function(){h("checking channel state, current state = "+a.readyState),"open"===a.readyState&&d()},500)))}function w(){!X&&O&&(X=setInterval(x,O))}function x(){var a=Date.now()-4*O;S.keys().forEach(function(b){var c=S.get(b);return c.lastping<a?n(b):void J.to(b).send("/ping")})}function y(){clearInterval(X),X=0}function z(){return U&&U.init(l,function(a){return a?console.error("Could not initialize plugin: ",a):(H=!0,void p())})}function A(a){a&&"undefined"!=typeof a.room&&(L=a.room)}function B(a,b){b.allow=b.allow&&R.length>=V}function C(a){var b=a&&a.id,c=b&&S.get(b);return b&&!c?(h("received peer update from peer "+b+", no active calls"),J.to(b).send("/reconnect"),q(b)):void 0}function D(a){var b=S.get(a&&a.id);b&&(b.lastping=Date.now())}function E(a){S.get(a);return function(b){J("stream:added",a,b,u(a))}}function F(a){var b=S.get(a);b&&b.pc&&(b.streams=[].concat(b.pc.getRemoteStreams()))}var G,H,I="undefined"!=typeof location&&location.hash.slice(1),J=a("rtc-signaller")(k(b),l),K=(l||{}).ns||"",L=(l||{}).room,M=(l||{}).debug,N=!(l||{}).manualJoin,O=(l||{}).heartbeat||2500,P={},Q=!1,R=[],S=J.calls=j({}),T={},U=(J.plugins=(l||{}).plugins||[],g(J.plugins)),V=parseInt((l||{}).expectedLocalStreams,10)||0,W=0,X=0,Y=0;return L||("undefined"==typeof location||I||(I=location.hash=""+Math.pow(2,53)*Math.random()),L=K+"#"+I),M&&d.logger.enable.apply(d.logger,Array.isArray(h)?M:["*"]),J.on("peer:announce",function(a){q(a.id)}),J.on("peer:update",C),J.on("message:reconnect",function(a){q(a.id)}),J.broadcast=J.addStream=function(a){return R.push(a),S.values().forEach(function(b){b.pc.addStream(a)}),p(),J},J.endCalls=function(){S.keys().forEach(n)},J.close=function(){J.endCalls(),J.leave()},J.createDataChannel=function(a,b){return S.keys().forEach(function(c){var d,e=S.get(c);e&&e.pc&&J.isMaster(c)&&(d=e.pc.createDataChannel(a,b),v(d,e.pc,u(c)))}),T[a]=b||null,J},J.join=function(){N=!0,p()},J.get=function(a){return P[a]},J.getLocalStreams=function(){return[].concat(R)},J.reactive=function(){return l=l||{},l.reactive=!0,J},J.removeStream=function(a){var b=R.indexOf(a);return S.values().forEach(function(b){b.pc.removeStream(a)}),b>=0&&R.splice(b,1),J},J.requestChannel=function(a,b,c){var d=t(a),e=d&&d.channels.get(b);return e?(c(null,e),J):(J.once("channel:opened:"+b,function(a,b){c(null,b)}),J)},J.requestStream=function(a,b,c){function d(g){g===a&&(e=f.pc.getRemoteStreams()[b],e&&(J.removeListener("stream:added",d),c(null,e)))}var e,f=t(a);return(e=f.pc.getRemoteStreams()[b])?(c(null,e),J):(J.on("stream:added",d),J)},J.profile=function(a){return i(P,a),Q&&(clearTimeout(Y),Y=setTimeout(function(){J.announce(P)},(l||{}).updateDelay||1e3)),J},J.waitForCall=function(a,b){var c=S.get(a);return c&&c.active?(b(null,c.pc),J):void J.on("call:started",function d(c){c===a&&(J.removeListener("call:started",d),b(null,S.get(c).pc))})},V&&J.on("peer:filter",B),J.on("local:announce",A),J.on("message:ping",D),a("rtc-core/genice")(l,function(a,b){return a?console.error("could not find iceServers: ",a):(G=b,void p())}),U&&z(),J}}).call(this,a("_process"))},{"./messenger":2,_process:9,"cog/defaults":3,"cog/extend":4,"cog/getable":5,mbus:10,"rtc-core/genice":14,"rtc-core/plugin":16,"rtc-signaller":20,"rtc-tools":49,"rtc-tools/cleanup":45}],2:[function(a,b){b.exports=function(b){return"function"==typeof b?b:a("rtc-switchboard-messenger")(b)}},{"rtc-switchboard-messenger":36}],3:[function(a,b){"use strict";b.exports=function(a){return a=a||{},[].slice.call(arguments,1).forEach(function(b){if(b)for(var c in b)void 0===a[c]&&(a[c]=b[c])}),a}},{}],4:[function(a,b){"use strict";b.exports=function(a){return[].slice.call(arguments,1).forEach(function(b){if(b)for(var c in b)a[c]=b[c]}),a}},{}],5:[function(a,b){b.exports=function(a){function b(b){return a[b]}function c(b,c){a[b]=c}function d(b){return delete a[b]}function e(){return Object.keys(a)}function f(){return Object.keys(a).map(function(b){return a[b]})}return"object"!=typeof a?a:{get:b,set:c,remove:d,"delete":d,keys:e,values:f}}},{}],6:[function(a,b){"use strict";b.exports=function(a){var b,c,d,e="string"==typeof a||a instanceof String,f=/^\-?\d+\.?\d*$/;if(!e||a.length<2)return e&&f.test(a)?parseFloat(a):a;if("true"===a||"false"===a)return"true"===a;if("null"===a)return null;if(c=a.charAt(0),d=a.charAt(a.length-1),b="{"==c&&"}"==d||"["==c&&"]"==d||'"'==c&&'"'==d)try{return JSON.parse(a)}catch(g){}return f.test(a)?parseFloat(a):a}},{}],7:[function(a,b){"use strict";var c=[],d=[],e=[console],f=b.exports=function(a){function b(){return f=c.indexOf("*")>=0||c.indexOf(a)>=0}var f=b();return d[d.length]=b,function(){var b=[].slice.call(arguments);("string"==typeof b[0]||b[0]instanceof String)&&(b[0]=a+": "+b[0]),f&&e.forEach(function(a){a.log.apply(a,b)})}};f.reset=function(){return e=[],c=[],f.enable()},f.to=function(a){return e=e.concat(a||[]),f},f.enable=function(){return c=c.concat([].slice.call(arguments)),d.forEach(function(a){a()}),f}},{}],8:[function(a,b){"use strict";b.exports=function(a,b,c){function d(){a.apply(g,f||[]),h=Date.now()}var e,f,g,h=(c||{}).leading!==!1?0:Date.now(),i=(c||{}).trailing;return i=i||void 0===i,function(){var c=Date.now(),j=c-h;return clearTimeout(e),b>j?(f=[].slice.call(arguments,0),g=this,i&&(e=setTimeout(d,b-j))):(h=c,void a.apply(this,arguments))}}},{}],9:[function(a,b){function c(){if(!g){g=!0;for(var a,b=f.length;b;){a=f,f=[];for(var c=-1;++c<b;)a[c]();b=f.length}g=!1}}function d(){}var e=b.exports={},f=[],g=!1;e.nextTick=function(a){f.push(a),g||setTimeout(c,0)},e.title="browser",e.browser=!0,e.env={},e.argv=[],e.version="",e.on=d,e.addListener=d,e.once=d,e.off=d,e.removeListener=d,e.removeAllListeners=d,e.emit=d,e.binding=function(){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(){throw new Error("process.chdir is not supported")},e.umask=function(){return 0}},{}],10:[function(a,b){var c=a("array-trie"),d=/[\.\:]/,e=b.exports=function(a,b,f){function g(b){var c,d=[].slice.call(arguments,1),e=j(b),h=e.join("."),i=n.get(e)||[];return o.forEach(function(a){a({name:h,args:d})}),c=[].concat(i).map(function(a){return a.apply(f||this,d)}),g.parent&&(c=c.concat(g.parent.apply(f||this,[a.concat(e)].concat(d)))),c}function h(a){a?n.set(j(a),[]):n=c()}function i(a){function b(){o.splice(o.indexOf(a),1)}return o.push(a),b}function j(a){return Array.isArray(a)?a:a?a.split(d):[]}function k(a,b){var c=n.get(j(a)),d=c?c.indexOf(b):-1;d>=0&&c.splice(d,1)}function l(a,b){var c=j(a),d=n.get(c);return d?d.push(b):n.set(c,[b]),g}function m(a,b){return l(a,function c(){var d=b.apply(this,arguments);return g.off(a,c),d})}var n=c(),o=[];return"function"==typeof a&&(b=a,a=""),a=a&&a.split(d)||[],g.clear=g.removeAllListeners=h,g.feed=i,g.on=g.addListener=l,g.once=m,g.off=g.removeListener=k,g.parent=b||a&&a.length>0&&e(),g}},{"array-trie":12}],11:[function(a,b){"use strict";function c(a,b,c,d,e,f){var g=["function ",a,"(a,l,h,",d.join(","),"){",f?"":"var i=",c?"l-1":"h+1",";while(l<=h){var m=(l+h)>>>1,x=a",e?".get(m)":"[m]"];return f?g.push(b.indexOf("c")<0?";if(x===y){return m}else if(x<=y){":";var p=c(x,y);if(p===0){return m}else if(p<=0){"):g.push(";if(",b,"){i=m;"),g.push(c?"l=m+1}else{h=m-1}":"h=m-1}else{l=m+1}"),g.push("}"),g.push(f?"return -1};":"return i};"),g.join("")}function d(a,b,d,e){var f=new Function([c("A","x"+a+"y",b,["y"],!1,e),c("B","x"+a+"y",b,["y"],!0,e),c("P","c(x,y)"+a+"0",b,["y","c"],!1,e),c("Q","c(x,y)"+a+"0",b,["y","c"],!0,e),"function dispatchBsearch",d,"(a,y,c,l,h){if(a.shape){if(typeof(c)==='function'){return Q(a,(l===undefined)?0:l|0,(h===undefined)?a.shape[0]-1:h|0,y,c)}else{return B(a,(c===undefined)?0:c|0,(l===undefined)?a.shape[0]-1:l|0,y)}}else{if(typeof(c)==='function'){return P(a,(l===undefined)?0:l|0,(h===undefined)?a.length-1:h|0,y,c)}else{return A(a,(c===undefined)?0:c|0,(l===undefined)?a.length-1:l|0,y)}}}return dispatchBsearch",d].join(""));return f()}b.exports={ge:d(">=",!1,"GE"),gt:d(">",!1,"GT"),lt:d("<",!0,"LT"),le:d("<=",!0,"LE"),eq:d("-",!0,"EQ",!0)}},{}],12:[function(a,b){"use strict";function c(a,b,c){this.symbols=a,this.children=b,this.value=c}function d(){return new c([],[])}var e=a("binary-search-bounds");b.exports=d;var f=c.prototype;f.set=function(a,b){if(a.shape){for(var d=this,f=a.shape[0],g=0;f>g;++g){var h=a.get(g),i=e.ge(d.symbols,h);if(!(i<d.symbols.length&&d.symbols[i]===h)){for(var j=new c([],[],b),k=f-1;k>g;--k)j=new c([a.get(k)],[j]);return d.symbols.splice(i,0,h),d.children.splice(i,0,j),b}d=d.children[i]}return d.value=b}for(var d=this,f=a.length,g=0;f>g;++g){var h=a[g],i=e.ge(d.symbols,h);if(!(i<d.symbols.length&&d.symbols[i]===h)){for(var j=new c([],[],b),k=f-1;k>g;--k)j=new c([a[k]],[j]);return d.symbols.splice(i,0,h),d.children.splice(i,0,j),b}d=d.children[i]}return d.value=b},f.get=function(a){if(a.shape){for(var b=this,c=a.shape[0],d=0;c>d;++d){var f=a.get(d),g=e.eq(b.symbols,f);if(0>g)return;b=b.children[g]}return b.value}for(var b=this,c=a.length,d=0;c>d;++d){var f=a[d],g=e.eq(b.symbols,f);if(0>g)return;b=b.children[g]}return b.value}},{"binary-search-bounds":11}],13:[function(a,b){"use strict";var c=a("detect-browser"),d=b.exports=function(a,b){var c,e,f,g=(b||{}).attach,h=this||("undefined"!=typeof window?window:void 0),i=((b||{}).prefixes||["ms","o","moz","webkit"]).concat("");if(h)for(c=i.length;c--;)if(e=i[c],f=e+(e?a.charAt(0).toUpperCase()+a.slice(1):a),"undefined"!=typeof h[f])return d.browser=d.browser||e.toLowerCase(),g&&(h[a]=h[f]),h[f]};d.moz="undefined"!=typeof navigator&&!!navigator.mozGetUserMedia,d.browser=c.name,d.browserVersion=d.version=c.version},{"detect-browser":15}],14:[function(a,b){b.exports=function(a,b){var c=(a||{}).ice,d=(a||{}).iceServers;return"function"==typeof c?c(a,b):Array.isArray(c)?b(null,[].concat(c)):void b(null,[].concat(d||[]))}},{}],15:[function(a,b,c){function d(a){return a.concat(a[1].exec(navigator.userAgent))}function e(a){return!!a[2]}for(var f=[["chrome",/Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+)\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/iPad\;\sCPU\sOS\s([0-9\._]+)/],["ios",/iPhone\;\sCPU\siPhone\sOS\s([0-9\._]+)/],["safari",/Safari\/([0-9\._]+)/]],d=f.map(d).filter(e)[0],g=d&&d[3].split(/[._]/).slice(0,3);g&&g.length<3;)g.push("0");c.name=d&&d[0],c.version=g&&g.join(".")},{}],16:[function(a,b){function c(a){return a&&"function"==typeof a.supported&&a.supported(e)}function d(a){var b=f.filter(function(b){return"function"==typeof a[b]});return b.length===f.length}var e=a("./detect"),f=["init"];b.exports=function(a){return[].concat(a||[]).filter(c).filter(d)[0]}},{"./detect":13}],17:[function(a,b){b.exports={dataEvent:"data",openEvent:"open",closeEvent:"close",errorEvent:"error",writeMethod:"write",closeMethod:"close",leaveTimeout:3e3}},{}],18:[function(a,b){"use strict";var c=a("cog/extend");b.exports=function(a){function b(b){var d=c({allow:!0},b);return a("peer:filter",b.id,d),d.allow}return function(d,e,f,g,h){var i,j=d[0];if(j&&j.id&&j.id!==a.id){if(!b(j))return;return i=a.peers.get(j.id),a("peer:connected",j.id,j),i&&!i.inactive?(c(i.data,j),a("peer:update",j,f)):(i={id:j.id,roleIdx:[j.id,a.id].sort().indexOf(j.id),data:{}},c(i.data,j),clearTimeout(i.leaveTimer),i.inactive=!1,a.peers.set(j.id,i),a.autoreply&&!h&&a.to(j.id).send("/announce",a.attributes),a("peer:announce",j,i))}}}},{"cog/extend":4}],19:[function(a,b){"use strict";b.exports=function(b,c){return{announce:a("./announce")(b,c)}}},{"./announce":18}],20:[function(a,b){"use strict";var c=a("rtc-core/detect"),d=a("cog/defaults"),e=a("cog/extend"),f=a("mbus"),g=a("cog/getable"),h=a("cuid"),i=a("pull-stream"),j=a("pull-pushable"),k=0,l=1,m=2,n={version:"5.2.2"};b.exports=function(b,o){function p(){A.announce()}function q(a){E.push(r(a)),G!==k||void 0!==x&&!x||H()}function r(a){return a.map(u).join("|")}function s(){return e({},z,{id:A.id})}function t(){(void 0===y||y)&&setTimeout(H,50)}function u(a){return"object"!=typeof a||a instanceof String?"function"==typeof a?null:a:JSON.stringify(a)}var v,w=(o||{}).autoreply,x=(o||{}).autoconnect,y=(o||{}).reconnect,z={},A=f("",(o||{}).logger),B=A.id=(o||{}).id||h(),C=A.attributes={browser:c.browser,browserVersion:c.browserVersion,id:B,agent:"signaller@"+n.version},D=A.peers=g({}),E=a("pull-pushable")(),F=0,G=k,H=A.connect=function(){G!==l&&(G=l,b(function(a,b,c){return a?(G=k,A("error",a)):(G=m,i(b,i.through(null,function(){G=k,A("disconnected")}),i.drain(v)),i(E,c),A.removeListener("disconnected",t),A.on("disconnected",t),void A("connected"))}))},I=A.send=function(){var a=[].slice.call(arguments);a.splice(1,0,s()),q(a)};return A.announce=function(a,b){function c(){(b||I)("/announce",C),A("local:announce",C)}return G===m&&(A.removeListener("connected",p),A.on("connected",p)),clearTimeout(F),e(C,a,{id:A.id}),F=setTimeout(c,(o||{}).announceDelay||10)},A.isMaster=function(a){var b=D.get(a);return b&&0!==b.roleIdx},A.leave=A.close=function(){I("/leave",{id:B}),A.removeListener("disconnected",t),A.removeListener("connected",p),E.end(),E=j(),G=k},A.metadata=function(a){return 0===arguments.length?e({},z):void(z=e({},a))},A.to=function(a){var b=function(){var b,c=A.peers.get(a);if(!c)throw new Error("Unknown peer: "+a);c.inactive||(b=["/to",a].concat([].slice.call(arguments)),b.splice(3,0,s()),q(b))};return{announce:function(a){return A.announce(a,b)},send:b}},o=d({},o,a("./defaults")),A.autoreply=void 0===w||w,A.process=v=a("./processor")(A,o),(void 0===x||x)&&H(),A}},{"./defaults":17,"./processor":35,"cog/defaults":3,"cog/extend":4,"cog/getable":5,cuid:21,mbus:10,"pull-pushable":22,"pull-stream":29,"rtc-core/detect":13}],21:[function(a,b){!function(a){"use strict";var c="cuid",d=0,e=4,f=36,g=Math.pow(f,e),h=function(a,b){var c="000000000"+a;return c.substr(c.length-b)},i=function(){return h((Math.random()*g<<0).toString(f),e)},j=function(){return d=g>d?d:0,d++,d-1},k=function(){var a,b="c",c=(new Date).getTime().toString(f),d=k.fingerprint(),g=i()+i();return a=h(j().toString(f),e),b+c+a+d+g};k.slug=function(){var a,b=(new Date).getTime().toString(36),c=k.fingerprint().slice(0,1)+k.fingerprint().slice(-1),d=i().slice(-2);return a=j().toString(36).slice(-4),b.slice(-2)+a+c+d},k.globalCount=function(){var a=function(){var a,b=0;for(a in window)b++;return b}();return k.globalCount=function(){return a},a},k.fingerprint=function(){return h((navigator.mimeTypes.length+navigator.userAgent.length).toString(36)+k.globalCount().toString(36),4)},a.register?a.register(c,k):"undefined"!=typeof b?b.exports=k:a[c]=k}(this.applitude||this)},{}],22:[function(a,b){var c=a("pull-stream");b.exports=c.Source(function(a){function b(){for(var a;g.length&&((a=e.length)||d);){var b=e.shift(),c=f.shift();g.shift()(a?null:d,b),c&&c(d===!0?null:d)}}function c(c,e){d=d||c,g.push(e),b(),d&&a&&a(d===!0?null:d)}var d,e=[],f=[],g=[];return c.push=function(a,c){return d?c&&c(d===!0?null:d):(e.push(a),f.push(c),void b())},c.end=function(c,e){"function"==typeof c&&(e=c,c=!0),d=d||c||!0,e&&f.push(e),b(),d&&a&&a(d===!0?null:d)},c})},{"pull-stream":23}],23:[function(a,b,c){var d=a("./sources"),e=a("./sinks"),f=a("./throughs"),g=a("pull-core");for(var h in d)c[h]=g.Source(d[h]);for(var h in f)c[h]=g.Through(f[h]);for(var h in e)c[h]=g.Sink(e[h]);var i=a("./maybe")(c);for(var h in i)c[h]=i[h];c.Duplex=c.Through=c.pipeable=g.Through,c.Source=c.pipeableSource=g.Source,c.Sink=c.pipeableSink=g.Sink},{"./maybe":24,"./sinks":26,"./sources":27,"./throughs":28,"pull-core":25}],24:[function(a,b){var c=a("pull-core"),d=c.prop,e=c.id,f=c.maybeSink;b.exports=function(a){{var b={},c=a.drain,g=(b.find=function(a,b){return f(function(b){var f=!1;return b?a=d(a)||e:(b=a,a=e),c(function(c){return a(c)?(f=!0,b(null,c),!1):void 0},function(a){f||b(a===!0?null:a,null)})},b)},b.reduce=function(a,b,d){return f(function(d){return c(function(c){b=a(b,c)},function(a){d(a,b)})},d)});b.collect=b.writeArray=function(a){return g(function(a,b){return a.push(b),a},[],a)}}return b}},{"pull-core":25}],25:[function(a,b,c){function d(a){return"function"!=typeof a?a:(a.pipe=a.pipe||function(b){if("function"!=typeof b)throw new Error("must pipe to reader");return d(b(a))},a.type="Source",a)}c.id=function(a){return a},c.prop=function(a){if("string"==typeof a){var b=a;return function(a){return a[b]}}return a},c.tester=function(a){return a?"object"==typeof a&&"function"==typeof a.test?a.test.bind(a):c.prop(a)||c.id:c.id},c.addPipe=d;var e=(c.Source=function(a){function b(){var b=[].slice.call(arguments);return d(a.apply(null,b))}return b.type="Source",b},c.Through=function(a){return function(){function b(b){for(c.unshift(b),b=a.apply(null,c);d.length;)b=d.shift()(b);return b}var c=[].slice.call(arguments),d=[];return b.pipe=function(a){if(d.push(a),"Source"===a.type)throw new Error("cannot pipe "+b.type+" to Source");return b.type="Sink"===a.type?"Sink":"Through",b},b.type="Through",b}}),f=c.Sink=function(a){return function(){function b(b){return c.unshift(b),a.apply(null,c)}var c=[].slice.call(arguments);if(!a)throw new Error("must be createReader function");return b.type="Sink",b}};c.maybeSink=c.maybeDrain=function(a,b){return b?f(function(c){return a(b)(c)})():e(function(b){var c;return function(d,e){return d?b(d,e):c?e(c):void a(function(a,b){c=a||!0,a?e(c):e(null,b)})(b)}})()}},{}],26:[function(a,b,c){{var d=c.drain=function(a,b,c){!function d(){for(var e=!0,f=!1;e;)if(f=!1,a(null,function(g,h){f=!0,g?(e=!1,c&&c(g===!0?null:g)):b&&!1===b(h)?(e=!1,a(!0,c||function(){})):e||d()}),!f)return void(e=!1)}()};c.onEnd=function(a,b){return d(a,null,b)},c.log=function(a,b){return d(a,function(a){console.log(a)},b)}}},{}],27:[function(a,b,c){{var d=(c.keys=function(a){return e(Object.keys(a))},c.once=function(a){return function(b,c){if(b)return c(b);if(null!=a){var d=a;a=null,c(null,d)}else c(!0)}}),e=c.values=c.readArray=function(a){Array.isArray(a)||(a=Object.keys(a).map(function(b){return a[b]}));var b=0;return function(c,d){return c?d&&d(c):void d(b>=a.length||null,a[b++])}};c.count=function(a){var b=0;return a=a||1/0,function(c,d){return c?d&&d(c):b>a?d(!0):void d(null,b++)}},c.infinite=function(a){return a=a||Math.random,function(b,c){return b?c&&c(b):c(null,a())}},c.defer=function(){var a,b,c=[],d=function(d,e){a?a(d,e):(b=d,c.push(e))};return d.resolve=function(d){if(a)throw new Error("already resolved");if(a=d,!a)throw new Error("no read cannot resolve!"+a);for(;c.length;)a(b,c.shift())},d.abort=function(a){d.resolve(function(b,c){c(a||!0)})},d},c.empty=function(){return function(a,b){b(!0)}},c.depthFirst=function(a,b){var c=[];return c.unshift(d(a)),function e(a,d){return c.length?void c[0](a,function(a,f){return a?(c.shift(),e(null,d)):(c.unshift(b(f)),void d(a,f))}):d(!0)}},c.widthFirst=function(a,b){var c=[];return c.push(d(a)),function e(a,d){return c.length?void c[0](a,function(a,f){return a?(c.shift(),e(null,d)):(c.push(b(f)),void d(a,f))}):d(!0)}},c.leafFirst=function(a,b){var c=[],e=[];return c.push(d(a)),function f(a,d){c[0](a,function(a,g){return a?(c.shift(),e.length?d(null,e.shift()):d(!0)):(c.unshift(b(g)),e.unshift(g),void f(null,d))})}}}},{}],28:[function(a,b,c){(function(b){{var d=a("pull-core"),e=a("./sources"),f=a("./sinks"),g=d.prop,h=d.id,i=d.tester,j=(c.map=function(a,b){return b=g(b)||h,function(c,d){a(c,function(a,c){var c=a?null:b(c);d(a,c)})}},c.asyncMap=function(a,b){return b?function(c,d){return c?a(c,d):void a(null,function(a,c){return a?d(a,c):void b(c,d)})}:a},c.paraMap=function(a,b,c){function d(){if(f){var a=f;return f=null,h.length?a(null,h.shift()):g&&!i?a(g):void(f=a)}}function e(){a(null,function(a,f){return a?(g=a,d()):(i++,b(f,function(a,b){i--,h.push(b),d()}),void(c>i&&!g&&e()))})}if(!b)return a;var f,g=!1,h=[],i=0;return function(b,c){return b?a(b,c):(f=c,void(h.length||g?(e(),d()):e()))}},c.filter=function(a,b){return b=i(b),function c(d,e){a(d,function(a,d){return a||b(d)?void e(a,d):c(a,e)})}}),k=(c.filterNot=function(a,b){return b=i(b),j(a,function(a){return!b(a)})},c.through=function(a,b,c){function d(a){!e&&c&&(e=!0,c(a===!0?null:a))}var e=!1;return function(c,e){return c&&d(c),a(c,function(a,c){a?d(a):b&&b(c),e(a,c)})}},c.take=function(a,b){var c=!1;if("number"==typeof b){var d=b;b=function(){return d--}}return function(d,e){return c?e(c):(c=d)?a(c,e):void a(null,function(d,f){return(c=c||d)?e(c):void(b(f)?e(null,f):(c=!0,a(!0,function(a,b){e(c,b)})))})}},c.unique=function(a,b,c){b=g(b)||h;var d={};return j(a,function(a){var e=b(a);return d[e]?!!c:(d[e]=!0,!c)})}),l=(c.nonUnique=function(a,b){return k(a,b,!0)},c.group=function(a,b){var c;b=b||5;var d=[];return function(e,f){return e?a(c=e,f):c?f(c):void a(null,function g(e,h){if(c=c||e){if(!d.length)return f(c);var i=d;return d=[],f(null,i)}if(d.push(h),d.length<b)return a(null,g);var i=d;d=[],f(null,i)})}},c.flatten=function(a){var b;return function(c,d){function f(){b(null,function(a,b){a?g():d(null,b)})}function g(){a(null,function(a,c){if(a)return d(a);if(Array.isArray(c))c=e.values(c);else if("function"!=typeof c)throw new Error("expected stream of streams");b=c,f()})}b?f():g()}},c.prepend=function(a,b){return function(c,d){if(null!==b){if(c)return a(c,d);var e=b;b=null,d(null,e)}else a(c,d)}},c._reduce=function(a,b,c){return function(d,e){return d?a(d,e):ended?e(ended):void f.drain(function(a){c=b(c,a)},function(a){ended=a||!0,a?e(ended):e(null,c)})(a)}},b.nextTick);c.highWaterMark=function(a,b){function c(){for(;g.length&&(f.length||e);)g.shift()(e,e?null:f.shift())}function d(){return e||h||f.length>=b?void 0:(h=!0,a(e,function(a,b){h=!1,e=e||a,null!=b&&f.push(b),d(),c()}))}var e,f=[],g=[],h=!1;return b=b||10,l(d),function(a,b){e=e||a,g.push(b),d(),c()}}}}).call(this,a("_process"))},{"./sinks":26,"./sources":27,_process:9,"pull-core":25}],29:[function(a,b,c){function d(a){return"function"==typeof a}function e(a){return a&&("Through"===a.type||1===a.length)}var f=a("./sources"),g=a("./sinks"),h=a("./throughs"),i=a("pull-core"),c=b.exports=function l(){function a(){var c=b.shift();return null==c?a():d(c)?c:function(a){return c.sink(a),c.source}}var b=[].slice.call(arguments);if(e(b[0]))return function(a){return b.unshift(a),l.apply(null,b)};var c=b.shift();for(d(c.source)&&(c=c.source);b.length;)c=a()(c);return c};for(var j in f)c[j]=i.Source(f[j]);for(var j in h)c[j]=i.Through(h[j]);for(var j in g)c[j]=i.Sink(g[j]);var k=a("./maybe")(c);for(var j in k)c[j]=k[j];c.Duplex=c.Through=c.pipeable=i.Through,c.Source=c.pipeableSource=i.Source,c.Sink=c.pipeableSink=i.Sink},{"./maybe":30,"./sinks":32,"./sources":33,"./throughs":34,"pull-core":31}],30:[function(a,b){var c=a("pull-core"),d=c.prop,e=c.id,f=c.maybeSink;b.exports=function(a){{var b={},c=a.drain,g=(b.find=function(a,b){return f(function(b){var f=!1;return b?a=d(a)||e:(b=a,a=e),c(function(c){return a(c)?(f=!0,b(null,c),!1):void 0},function(a){f||b(a===!0?null:a,null)})},b)},b.reduce=function(a,b,d){return f(function(d){return c(function(c){b=a(b,c)},function(a){d(a,b)})},d)});b.collect=b.writeArray=function(a){return g(function(a,b){return a.push(b),a},[],a)},b.concat=function(a){return g(function(a,b){return a+b},"",a)}}return b}},{"pull-core":31}],31:[function(a,b,c){arguments[4][25][0].apply(c,arguments)},{dup:25}],32:[function(a,b,c){{var d=c.drain=function(a,b,c){!function d(){for(var e=!0,f=!1;e;)if(f=!1,a(null,function(g,h){if(f=!0,g){if(e=!1,c)c(g===!0?null:g);else if(g&&g!==!0)throw g}else b&&!1===b(h)?(e=!1,a(!0,c||function(){})):e||d()}),!f)return void(e=!1)}()};c.onEnd=function(a,b){return d(a,null,b)},c.log=function(a,b){return d(a,function(a){console.log(a)},b)}}},{}],33:[function(a,b,c){{var d=(c.keys=function(a){return e(Object.keys(a))},c.once=function(a){return function(b,c){if(b)return c(b);if(null!=a){var d=a;a=null,c(null,d)}else c(!0)}}),e=c.values=c.readArray=function(a){Array.isArray(a)||(a=Object.keys(a).map(function(b){return a[b]}));var b=0;return function(c,d){return c?d&&d(c):void d(b>=a.length||null,a[b++])}};c.count=function(a){var b=0;return a=a||1/0,function(c,d){return c?d&&d(c):b>a?d(!0):void d(null,b++)}},c.infinite=function(a){return a=a||Math.random,function(b,c){return b?c&&c(b):c(null,a())}},c.defer=function(){var a,b,c=[],d=function(d,e){a?a(d,e):(b=d,c.push(e))};return d.resolve=function(d){if(a)throw new Error("already resolved");if(a=d,!a)throw new Error("no read cannot resolve!"+a);for(;c.length;)a(b,c.shift())},d.abort=function(a){d.resolve(function(b,c){c(a||!0)})},d},c.empty=function(){return function(a,b){b(!0)}},c.error=function(a){return function(b,c){c(a)}},c.depthFirst=function(a,b){var c=[];return c.unshift(d(a)),function e(a,d){return c.length?void c[0](a,function(a,f){return a?(c.shift(),e(null,d)):(c.unshift(b(f)),void d(a,f))}):d(!0)}},c.widthFirst=function(a,b){var c=[];return c.push(d(a)),function e(a,d){return c.length?void c[0](a,function(a,f){return a?(c.shift(),e(null,d)):(c.push(b(f)),void d(a,f))}):d(!0)}},c.leafFirst=function(a,b){var c=[],e=[];return c.push(d(a)),function f(a,d){c[0](a,function(a,g){return a?(c.shift(),e.length?d(null,e.shift()):d(!0)):(c.unshift(b(g)),e.unshift(g),void f(null,d))})}}}},{}],34:[function(a,b,c){(function(b){{var d=a("pull-core"),e=a("./sources"),f=a("./sinks"),g=d.prop,h=d.id,i=d.tester,j=(c.map=function(a,b){return b=g(b)||h,function(c,d){a(c,function(c,e){try{e=c?null:b(e)}catch(f){return a(f,function(){return d(f)})}d(c,e)})}},c.asyncMap=function(a,b){return b?function(c,d){return c?a(c,d):void a(null,function(a,c){return a?d(a,c):void b(c,d)})}:a},c.paraMap=function(a,b,c){function d(){if(f){var a=f;return f=null,h.length?a(null,h.shift()):g&&!i?a(g):void(f=a)}}function e(){a(null,function(a,f){return a?(g=a,d()):(i++,b(f,function(a,b){i--,h.push(b),d()}),void(c>i&&!g&&e()))})}if(!b)return a;var f,g=!1,h=[],i=0;return function(b,c){return b?a(b,c):(f=c,void(h.length||g?(e(),d()):e()))}},c.filter=function(a,b){return b=i(b),function c(d,e){for(var f,g=!0;g;)g=!1,f=!0,a(d,function(a,d){return a||b(d)?void e(a,d):f?g=!0:c(a,e)}),f=!1}}),k=(c.filterNot=function(a,b){return b=i(b),j(a,function(a){return!b(a)})},c.through=function(a,b,c){function d(a){!e&&c&&(e=!0,c(a===!0?null:a))}var e=!1;return function(c,e){return c&&d(c),a(c,function(a,c){a?d(a):b&&b(c),e(a,c)})}},c.take=function(a,b){var c=!1;if("number"==typeof b){var d=b;b=function(){return d--}}return function(d,e){return c?e(c):(c=d)?a(c,e):void a(null,function(d,f){return(c=c||d)?e(c):void(b(f)?e(null,f):(c=!0,a(!0,function(a,b){e(c,b)})))})}},c.unique=function(a,b,c){b=g(b)||h;var d={};return j(a,function(a){var e=b(a);return d[e]?!!c:(d[e]=!0,!c)})});c.nonUnique=function(a,b){return k(a,b,!0)},c.group=function(a,b){var c;b=b||5;var d=[];return function(e,f){return e?a(c=e,f):c?f(c):void a(null,function g(e,h){if(c=c||e){if(!d.length)return f(c);var i=d;return d=[],f(null,i)}if(d.push(h),d.length<b)return a(null,g);var i=d;d=[],f(null,i)})}},c.flatten=function(a){var b;return function(c,d){function f(){b(null,function(a,b){a?g():d(null,b)})}function g(){a(null,function(a,c){if(a)return d(a);if(Array.isArray(c)||c&&"object"==typeof c)c=e.values(c);else if("function"!=typeof c)throw new Error("expected stream of streams");b=c,f()})}b?f():g()}},c.prepend=function(a,b){return function(c,d){if(null!==b){if(c)return a(c,d);var e=b;b=null,d(null,e)}else a(c,d)}},c._reduce=function(a,b,c){return function(d,e){return d?a(d,e):ended?e(ended):void f.drain(function(a){c=b(c,a)},function(a){ended=a||!0,a?e(ended):e(null,c)})(a)}},b.nextTick,c.highWaterMark=function(a,c){function d(){for(;i.length&&(h.length||f);)i.shift()(f,f?null:h.shift());!h.length&&g&&(f=g)}function e(){return f||g||j||h.length>=c?void 0:(j=!0,a(f||g,function(a,b){j=!1,g=g||a,null!=b&&h.push(b),e(),d()}))}var f,g,h=[],i=[],j=!1;return c=c||10,b.nextTick(e),function(a,b){f=f||a,i.push(b),e(),d()}},c.flatMap=function(a,b){b=b||h;var c,d=[];return function(e,f){return d.length?f(null,d.shift()):c?f(c):void a(e,function g(e,h){if(e)c=e;else for(var i=b(h);i&&i.length;)d.push(i.shift());d.length?f(null,d.shift()):c?f(c):a(null,g)})}}}}).call(this,a("_process"))},{"./sinks":32,"./sources":33,_process:9,"pull-core":31}],35:[function(a,b){"use strict";var c=a("cog/jsonparse");b.exports=function(b,d){function e(a,d,e){var f="message:"+a[0].slice(1),g=a.slice(2).map(c);b.apply(b,[f].concat(g).concat([d,e]))}var f=a("./handlers")(b,d);return function(a){var d,g,h,i,j=a,k=!0,l=!1;if(!j||"primus"!==j.slice(0,6)){var m=b.id+"";if("/to"===j.slice(0,3)&&(k=j.slice(4,m.length+4)===m,k&&(d=j.slice(5+m.length).split("|").map(c),l=!0,d=d.map(c))),k&&(b("rawdata",j),d=d||j.split("|").map(c),"string"==typeof d[0])){if(h=d[1],h&&h.id===b.id)return console.warn("got data from ourself, discarding");
i=b.peers.get(h&&h.id)||h,"/"===d[0].charAt(0)?(g=f[d[0].slice(1)],"function"==typeof g?g(d.slice(2),d[0].slice(1),h,i,l):e(d,i,a)):b("data",d.slice(0,1).concat(d.slice(2)),h,i,l)}}}}},{"./handlers":19,"cog/jsonparse":6}],36:[function(a,b){var c=a("cog/extend");b.exports=function(b,d){return a("messenger-ws")(b,c({endpoints:["/primus","/"]},d))}},{"cog/extend":4,"messenger-ws":37}],37:[function(a,b){var c=a("ws"),d=a("wsurl"),e=a("pull-ws"),f=(a("cog/defaults"),/\/$/);b.exports=function(a,b){function g(f){function g(){function i(){o=!0,(p.removeEventListener||p.removeListener)("message",i)}var p;return 0===n.length?f(new Error("Unable to connect to url: "+a)):(p=new c(d(n.shift())),p.addEventListener("error",k),p.addEventListener("close",j),p.addEventListener("open",function(){var a=e.source(p,b);p.addEventListener("message",i),m=setTimeout(function(){clearTimeout(l),f(null,a,e.sink(p,b))},100)}),void(l=setTimeout(g,h)))}function j(a){return a.wasClean&&o&&0===n.length?void 0:k()}function k(){clearTimeout(m),clearTimeout(l),g()}var l,m,n=[].concat(i),o=!1;g()}var h=(b||{}).timeout||1e3,i=((b||{}).endpoints||["/"]).map(function(b){return a.replace(f,"")+b});return g}},{"cog/defaults":3,"pull-ws":38,ws:43,wsurl:44}],38:[function(a,b,c){function d(a,b){return{source:c.source(a),sink:c.sink(a,b)}}c=b.exports=d,c.source=a("./source"),c.sink=a("./sink")},{"./sink":41,"./source":42}],39:[function(a,b,c){function d(a){return"function"!=typeof a?a:(a.pipe=a.pipe||function(b){if("function"!=typeof b&&"function"!=typeof b.sink)throw new Error("must pipe to reader");var c=d(b.sink?b.sink(a):b(a));return b.source||c},a.type="Source",a)}c.id=function(a){return a},c.prop=function(a){if("string"==typeof a){var b=a;return function(a){return a[b]}}return a},c.tester=function(a){return a?"object"==typeof a&&"function"==typeof a.test?a.test.bind(a):c.prop(a)||c.id:c.id},c.addPipe=d;var e=(c.Source=function(a){function b(){var b=[].slice.call(arguments);return d(a.apply(null,b))}return b.type="Source",b},c.Through=function(a){return function(){function b(b){for(c.unshift(b),b=a.apply(null,c);d.length;)b=d.shift()(b);return b}var c=[].slice.call(arguments),d=[];return b.pipe=function(a){if(d.push(a),"Source"===a.type)throw new Error("cannot pipe "+b.type+" to Source");return b.type="Sink"===a.type?"Sink":"Through",b},b.type="Through",b}}),f=c.Sink=function(a){return function(){function b(b){return c.unshift(b),a.apply(null,c)}var c=[].slice.call(arguments);if(!a)throw new Error("must be createReader function");return b.type="Sink",b}};c.maybeSink=c.maybeDrain=function(a,b){return b?f(function(c){return a(b)(c)})():e(function(b){var c;return function(d,e){return d?b(d,e):c?e(c):void a(function(a,b){c=a||!0,a?e(c):e(null,b)})(b)}})()}},{}],40:[function(a,b){b.exports=function(a,b){function c(){"function"==typeof f&&(f.call(a,"open",d),f.call(a,"error",e))}function d(){c(),b()}function e(a){c(),b(a)}var f=a&&(a.removeEventListener||a.removeListener);return a.readyState>=2?b(!0):1===a.readyState?b():(a.addEventListener("open",d),void a.addEventListener("error",e))}},{}],41:[function(a,b){(function(c){var d=a("pull-core"),e=a("./ready");b.exports=d.Sink(function(a,b,d){function f(d,i){return d?void(g&&b.readyState<=1&&(h&&b.addEventListener("close",function(a){if(a.wasClean)h();else{var b=new Error("ws error");b.event=a,h(b)}}),b.close())):void e(b,function(d){return d?a(d,function(){}):(b.send(i),void c.nextTick(function(){a(null,f)}))})}d=d||{};var g=d.closeOnEnd!==!1,h="function"==typeof d?d:d.onClose;a(null,f)})}).call(this,a("_process"))},{"./ready":40,_process:9,"pull-core":39}],42:[function(a,b){var c=a("pull-core"),d=a("./ready");b.exports=c.Source(function(a){function b(b,g){return c=null,e?g(e):b?(c=g,a.close()):void d(a,function(a){return a?g(e=a):e&&e!==!0?g(e):f.length>0?g(null,f.shift()):e?g(!0):void(c=g)})}var c,e,f=[];return a.addEventListener("message",function(a){return c?c(null,a.data):void f.push(a.data)}),a.addEventListener("close",function(){return e?void 0:c?c(e=!0):void 0}),a.addEventListener("error",function(a){e||(e=a,c&&c(e))}),b})},{"./ready":40,"pull-core":39}],43:[function(a,b){function c(a,b){var c;return c=b?new e(a,b):new e(a)}var d=function(){return this}(),e=d.WebSocket||d.MozWebSocket;b.exports=e?c:null,e&&(c.prototype=e.prototype)},{}],44:[function(a,b){var c=/^http(.*)$/;b.exports=function(a,b){var d=(b||{}).current||"undefined"!=typeof location&&location.href,e=d&&d.slice(0,d.indexOf(":")),f=(b||{}).insecure,g="//"==a.slice(0,2),h=!e||"file:"===e;return g?h?(f?"ws:":"wss:")+a:e.replace(c,"ws$1")+":"+a:a.replace(c,"ws$1")}},{}],45:[function(a,b){"use strict";var c=a("cog/logger")("rtc/cleanup"),d=["closed"],e=["addstream","datachannel","icecandidate","negotiationneeded","removestream","signalingstatechange"],f=["iceconnectionstatechange"];b.exports=function(a){function b(b){b.forEach(function(b){a["on"+b]&&(a["on"+b]=null)})}var g=a.iceConnectionState,h=d.indexOf(g)<0;b(e),h&&(c("attempting connection close, current state: "+a.iceConnectionState),a.close()),setTimeout(function(){b(f)},100)}},{"cog/logger":7}],46:[function(a,b){"use strict";function c(b,c,k,l){function m(){x("decoupling "+k.id+" from "+c),y.stop(),f(b),k.removeListener("sdp",o),k.removeListener("candidate",n),k.removeListener("negotiate",t),k.removeListener("message:sdp",o),k.removeListener("message:candidate",n),k.removeListener("message:negotiate",t)}function n(a){E.addIceCandidate(a)}function o(a,b){z("sdp.remote",a),b&&b.id===c&&E.setRemoteDescription(a)}function p(){x("captured pc close, iceConnectionState = "+b.iceConnectionState),m()}function q(){x("captured pc disconnect, monitoring connection status"),v=setTimeout(function(){x("manually closing connection after disconnect timeout"),f(b)},C),y.on("statechange",r)}function r(){return x("connection state changed to: "+b.iceConnectionState),j.indexOf(b.iceConnectionState)>=0?void 0:(u(),i.indexOf(b.iceConnectionState)>=0?y("closed"):void y.once("disconnect",q))}function s(a){var b;a.candidate?(u(),b={candidate:a.candidate.candidate,sdpMid:a.candidate.sdpMid,sdpMLineIndex:a.candidate.sdpMLineIndex},z("ice.local",b),k.to(c).send("/candidate",b),B=!1):B||(B=!0,z("ice.gathercomplete"),k.to(c).send("/endofcandidates",{}))}function t(a){a.id===c&&(z("negotiate.request",a.id),G())}function u(){y.off("statechange",r),x("reset disconnect timer, state: "+b.iceConnectionState),clearTimeout(v)}var v,w=(l||{}).debugLabel||"rtc",x=a("cog/logger")(w+"/couple"),y=g(b,c,k,(l||{}).logger),z=d("",y),A=(l||{}).reactive,B=!0,C=(l||{}).disconnectTimeout||1e4,D=k.isMaster(c),E=e(b,l),F=h(function(){return D?void E.createOffer():k.to(c).send("/negotiate")},100,{leading:!1}),G=h(E.createOffer,100,{leading:!1});return A&&(b.onnegotiationneeded=function(){z("negotiate.renegotiate"),F()}),b.onicecandidate=s,E.on("sdp.local",function(a){k.to(c).send("/sdp",a)}),k.on("sdp",o),k.on("candidate",n),k.on("message:sdp",o),k.on("message:candidate",n),D&&(k.on("negotiate",t),k.on("message:negotiate",t)),y.once("closed",p),y.once("disconnected",q),y.createOffer=F,y}var d=a("mbus"),e=a("rtc-taskqueue"),f=a("./cleanup"),g=a("./monitor"),h=a("cog/throttle"),i=["closed","failed"],j=["checking"];b.exports=c},{"./cleanup":45,"./monitor":50,"cog/logger":7,"cog/throttle":8,mbus:10,"rtc-taskqueue":51}],47:[function(a,b){"use strict";b.exports=a("rtc-core/detect")},{"rtc-core/detect":13}],48:[function(a,b,c){"use strict";var d=a("cog/logger")("generators"),e=a("./detect"),f=a("cog/defaults"),g={create:{dtls:function(a){e.moz||(a.optional=(a.optional||[]).concat({DtlsSrtpKeyAgreement:!0}))}}};c.config=function(a){var b=(a||{}).iceServerGenerator;return f({},a,{iceServers:"function"==typeof b?b():[]})},c.connectionConstraints=function(a,b){var c,e={},h=g.create;return Object.keys(a||{}).forEach(function(a){h[a]&&h[a](e)}),c=f({},b,e),d("generated connection constraints: ",c),c}},{"./detect":47,"cog/defaults":3,"cog/logger":7}],49:[function(a,b,c){"use strict";var d=a("./generators"),e=c.detect=a("./detect"),f=a("rtc-core/plugin");c.logger=a("cog/logger");var g=c.RTCPeerConnection=e("RTCPeerConnection");c.couple=a("./couple"),c.createConnection=function(a,b){var c=f((a||{}).plugins),e=(a||{}).RTCPeerConnection||g,h=d.config(a);return b=d.connectionConstraints(a,b),c&&"function"==typeof c.createConnection?c.createConnection(h,b):new e(h,b)}},{"./couple":46,"./detect":47,"./generators":48,"cog/logger":7,"rtc-core/plugin":16}],50:[function(a,b){"use strict";function c(a){return e[a]||a}var d=a("mbus"),e={completed:"connected"},f=["signalingstatechange","iceconnectionstatechange"];b.exports=function(a,b,e,g){function h(){var b=c(a.iceConnectionState);k("statechange",a,b),j!==b&&(k(b),j=b)}function i(){k("closed")}var j,k=d("",g);return a.onclose=i,f.forEach(function(b){a["on"+b]=h}),k.stop=function(){a.onclose=null,f.forEach(function(b){a["on"+b]=null})},k.checkState=h,a?(j=c(a.iceConnectionState),k):k}},{mbus:10}],51:[function(a,b){var c=a("rtc-core/detect"),d=a("rtc-core/plugin"),e=a("priorityqueuejs"),f=a("rtc-validator/candidate"),g=a("rtc-sdpclean"),h=100,i=1e3,j=["candidate","setLocalDescription","setRemoteDescription","createAnswer","createOffer"],k={setLocalDescription:"setlocaldesc",setRemoteDescription:"setremotedesc",createOffer:"offer",createAnswer:"answer"},l=["have-remote-offer","have-local-pranswer"];b.exports=function(b,m){function n(a,c){function d(){H("ice.remote.applied",g),c()}function e(a){H("ice.remote.invalid",g),c(a)}var f=a.args[0],g=f&&f.candidate&&r(f);return g?void b.addIceCandidate(g,d,e):c()}function o(){var a=!G.isEmpty()&&!F&&G.peek(),c=a&&D(a),d=!G.isEmpty()&&A(b);return K=0,c?(F=G.deq(),void F.fn(F,function(a){var b=F.fail||L,c=F.pass,d=F.name;return a?(console.error(d+" task failed: ",a),b(a)):("function"==typeof c&&c.apply(F,[].slice.call(arguments,1)),void setTimeout(function(){F=null,E()},0))})):d&&E()}function p(a){var c=[],d=a&&g(a.sdp,{collector:c});return a&&d!==a.sdp&&(console.info("invalid lines removed from sdp: ",c),a.sdp=d),"function"==typeof M&&(a.sdp=M(a.sdp,b)),a}function q(){return l.indexOf(b.signalingState)>=0?H.createAnswer():void 0}function r(a){return J&&"function"==typeof J.createIceCandidate?J.createIceCandidate(a):new O(a)}function s(a){return J&&"function"==typeof J.createSessionDescription?J.createSessionDescription(a):new N(a)}function t(){H("sdp.local",this.args[0])}function u(a,b,c){return function(){var d=[].slice.call(arguments);c&&"function"==typeof c.processArgs&&(d=d.map(c.processArgs)),G.enq({args:d,name:a,fn:b,checks:[A].concat((c||{}).checks||[]),pass:(c||{}).pass,fail:(c||{}).fail}),E()}}function v(a,c){function d(b){H.apply(H,["negotiate.error",a.name,b].concat(a.args)),c(b)}function e(){H.apply(H,[["negotiate",g,"ok"],a.name].concat(a.args)),c.apply(null,[null].concat([].slice.call(arguments)))}var f=b[a.name],g=k[a.name]||(a.name||"").toLowerCase(),h=[e,d],i="createOffer"===a.name;return"function"!=typeof f?c(new Error('cannot call "'+a.name+'" on RTCPeerConnection')):(H.apply(H,["negotiate."+g].concat(a.args)),void f.apply(b,a.args.concat(h).concat(i?x():[])))}function w(a){for(;a&&a.candidate&&a.candidate.candidate;)a=a.candidate;return a}function x(){var a={offertoreceivevideo:"OfferToReceiveVideo",offertoreceiveaudio:"OfferToReceiveAudio",icerestart:"IceRestart",voiceactivitydetection:"VoiceActivityDetection"},b={OfferToReceiveVideo:!0,OfferToReceiveAudio:!0};return Object.keys(m||{}).forEach(function(c){a[c.toLowerCase()]&&(b[a[c.toLowerCase()]]=m[c])}),{mandatory:b}}function y(a){return a.__hasDesc||(a.__hasDesc=!!a.remoteDescription)}function z(a){return"have-local-offer"!==a.signalingState}function A(a){return"closed"!==a.signalingState}function B(a,b){return b.__valid||(b.__valid=0===f(b.args[0]).length)}function C(a,b){var c=[a,b],d=c.map(D),e=c.map(function(a,b){var c=d[b],e=c&&I.indexOf(a.name);return c?e>=0?e:h:i});return e[1]-e[0]}function D(a){return(a.checks||[]).reduce(function(c,d){return c&&d(b,a)},!0)}function E(){K||(K=setTimeout(o,50))}var F,G=new e(C),H=a("mbus")("",(m||{}).logger),I=(m||{}).priorities||j,J=d((m||{}).plugins),K=0,L=H.bind(H,"fail"),M=(m||{}).sdpfilter||(m||{}).sdpFilter,N=(m||{}).RTCSessionDescription||c("RTCSessionDescription"),O=(m||{}).RTCIceCandidate||c("RTCIceCandidate");return H.addIceCandidate=u("addIceCandidate",n,{processArgs:w,checks:[y,B]}),H.setLocalDescription=u("setLocalDescription",v,{processArgs:p,pass:t}),H.setRemoteDescription=u("setRemoteDescription",v,{processArgs:s,pass:q}),H.createOffer=u("createOffer",v,{checks:[z],pass:H.setLocalDescription}),H.createAnswer=u("createAnswer",v,{pass:H.setLocalDescription}),H}},{mbus:10,priorityqueuejs:52,"rtc-core/detect":13,"rtc-core/plugin":16,"rtc-sdpclean":53,"rtc-validator/candidate":54}],52:[function(a,b){function c(a){this._comparator=a||c.DEFAULT_COMPARATOR,this._elements=[]}b.exports=c,c.DEFAULT_COMPARATOR=function(a,b){return a instanceof Number&&b instanceof Number?a-b:(a=a.toString(),b=b.toString(),a==b?0:a>b?1:-1)},c.prototype.isEmpty=function(){return 0===this.size()},c.prototype.peek=function(){if(this.isEmpty())throw new Error("PriorityQueue is empty");return this._elements[0]},c.prototype.deq=function(){var a=this.peek(),b=this._elements.pop(),c=this.size();if(0===c)return a;this._elements[0]=b;for(var d=0;c>d;){var e=d,f=2*d+1,g=2*d+2;if(c>f&&this._compare(f,e)>0&&(e=f),c>g&&this._compare(g,e)>0&&(e=g),e===d)break;this._swap(e,d),d=e}return a},c.prototype.enq=function(a){for(var b=this._elements.push(a),c=b-1;c>0;){var d=Math.floor((c-1)/2);if(this._compare(c,d)<0)break;this._swap(d,c),c=d}return b},c.prototype.size=function(){return this._elements.length},c.prototype.forEach=function(a){return this._elements.forEach(a)},c.prototype._compare=function(a,b){return this._comparator(this._elements[a],this._elements[b])},c.prototype._swap=function(a,b){var c=this._elements[a];this._elements[a]=this._elements[b],this._elements[b]=c}},{}],53:[function(a,b){function c(a){var b=e.exec(a);return b&&b[0]}var d=[[/^(a\=candidate.*)$/,a("rtc-validator/candidate")]],e=/(\r?\n|\\r\\n)/;b.exports=function(a,b){var e=c(a),f=a.split(e),g=(b||{}).collector;return f=f.filter(function(a){var b=d.reduce(function(b,c){return"undefined"!=typeof b?b:c[0].exec(a)&&{line:a.replace(c[0],"$1"),fn:c[1]}},void 0),c=b?b.fn(b.line):[];return g&&c.forEach(function(a){g.push(a)}),0===c.length}),f.join(e)}},{"rtc-validator/candidate":54}],54:[function(a,b){function c(a,b){var c=g[b];return c&&!c[0].test(a)?(d(c[2]+" part failed validation: "+a),new Error(c[1])):void 0}var d=a("cog/logger")("rtc-validator"),e=/^(?:a=)?candidate:/,f=/^(\d+\.){3}\d+$/,g=[[/.+/,"invalid foundation component","foundation"],[/\d+/,"invalid component id","component-id"],[/(UDP|TCP)/i,"transport must be TCP or UDP","transport"],[/\d+/,"numeric priority expected","priority"],[f,"invalid connection address","connection-address"],[/\d+/,"invalid connection port","connection-port"],[/typ/,'Expected "typ" identifier',"type classifier"],[/.+/,"Invalid candidate type specified","candidate-type"]];b.exports=function(a){var b=[],d=a&&(a.candidate||a),f=d&&e.exec(d),g=f&&d.slice(f[0].length).split(/\s/);return d?f?b=b.concat(g.map(c)).filter(Boolean):[new Error("candidate did not match expected sdp line format")]:[new Error("empty candidate")]}},{"cog/logger":7}]},{},[1])(1)});